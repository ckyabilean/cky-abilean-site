<!DOCTYPE html>
<html>
<head>
  <title>Animation Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
    }

    .items-container {
      padding: 40px 20px;
    }

    .item {
      font-size: 48px;
      margin-bottom: 120px;
      transition: transform 0.2s ease-out;
      cursor: pointer;
    }

    .sticky-container {
      position: sticky;
      top: 100px;
      height: 200px;
      z-index: 50;
      overflow: visible;
    }
    
    /* Letter effect styling */
    .letter {
      display: inline-block;
      transition: transform 0.3s ease-out;
    }
    
    @media (max-width: 768px) {
      .item {
        font-size: 32px;
      }
    }
  </style>
</head>
<body>
  <div id="content">
    <div class="items-container">
      <div class="item">ITEM A</div>
      <div class="item">ITEM B</div>
      <div class="item">ITEM C</div>
      <div class="item">ITEM D</div>
      <div class="item">ITEM E</div>
      <div class="item">ITEM F</div>
      <div class="item">ITEM G</div>
    </div>
  </div>
  
  <script>
    const items = document.querySelectorAll('.item');
    const content = document.getElementById('content');

    // Create sticky container
    const stickyContainer = document.createElement('div');
    stickyContainer.className = 'sticky-container';
    content.prepend(stickyContainer);

    // Item states
    const itemStates = {};

    // Split text into letter spans
    function splitTextIntoLetters(element) {
      const text = element.innerText;
      element.innerHTML = '';
      
      // Create a span for each letter
      for (let i = 0; i < text.length; i++) {
        const letter = document.createElement('span');
        letter.className = 'letter';
        letter.innerText = text[i];
        element.appendChild(letter);
      }
      
      return element.querySelectorAll('.letter');
    }

    window.addEventListener('scroll', () => {
      items.forEach((item, index) => {
        const rect = item.getBoundingClientRect();
        
        // If item reaches threshold
        if (rect.top < 200) {
          if (!itemStates[index]) {
            // Clone the item for the sticky container
            const clone = item.cloneNode(true);
            clone.id = `sticky-${index}`;
            clone.style.position = 'absolute';
            stickyContainer.appendChild(clone);
            
            // Split text into letters
            const letters = splitTextIntoLetters(clone);
            
            // Mark this item as at the top
            itemStates[index] = {
              element: clone,
              letters: letters,
              x: 0,
              y: 0, 
              rotation: 0,
              chaos: 0
            };
            
            // Hide original
            item.style.opacity = 0;
          }
          
          // Increase chaos based on how far we've scrolled past it
          const distancePastThreshold = 200 - rect.top;
          const chaos = Math.min(1, distancePastThreshold / 300);
          
          itemStates[index].chaos = chaos;
          
          // Apply letter separation effect
          itemStates[index].letters.forEach((letter, i) => {
            const randomX = (Math.random() * 60 - 30) * chaos;
            const randomY = (Math.random() * 40 - 20) * chaos;
            const randomRotate = (Math.random() * 40 - 20) * chaos;
            
            letter.style.transform = `translate(${randomX}px, ${randomY}px) rotate(${randomRotate}deg)`;
          });
          
          // Also apply some movement to the whole item
          itemStates[index].x += (Math.random() * 10 - 5) * chaos;
          itemStates[index].y = Math.random() * 10 * chaos;
          itemStates[index].rotation += (Math.random() * 5 - 2.5) * chaos;
          
          // Apply transformation to whole item
          itemStates[index].element.style.transform = 
            `translate(${itemStates[index].x}px, ${itemStates[index].y}px) rotate(${itemStates[index].rotation}deg)`;
        }
        // If scrolling back up
        else if (itemStates[index]) {
          // Smooth return for item position
          itemStates[index].x *= 0.8;
          itemStates[index].y *= 0.8;
          itemStates[index].rotation *= 0.8;
          
          // Smooth return for letters
          itemStates[index].letters.forEach(letter => {
            // Reset letter positions gradually
            letter.style.transform = 'translate(0px, 0px) rotate(0deg)';
          });
          
          // Apply reduced transformation to whole item
          itemStates[index].element.style.transform = 
            `translate(${itemStates[index].x}px, ${itemStates[index].y}px) rotate(${itemStates[index].rotation}deg)`;
          
          // If nearly reset, remove from sticky and show original
          if (Math.abs(itemStates[index].x) < 5 && 
              Math.abs(itemStates[index].y) < 5 && 
              Math.abs(itemStates[index].rotation) < 5) {
            stickyContainer.removeChild(itemStates[index].element);
            delete itemStates[index];
            item.style.opacity = 1;
          }
        }
      });
    });
  </script>
</body>
</html>
