<!DOCTYPE html>
<html>
<head>
  <title>Animation Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
    }

    .items-container {
      padding: 40px 20px;
    }

    .item {
      font-size: 48px;
      margin-bottom: 120px;
      transition: transform 0.2s ease-out, color 0.2s ease;
      cursor: pointer;
      display: block;
    }
    
    /* Hover state for items */
    .item:hover {
      color: #ff00ff; /* Much more dramatic magenta */
      transform: translateX(10px);
      cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 100 100'><path fill='%23ffffff' d='M50,5C25.1,5,5,25.1,5,50c0,24.9,20.1,45,45,45s45-20.1,45-45C95,25.1,74.9,5,50,5z M25.6,29.6c2.7-2.7,7.2-2.7,9.9,0 c2.7,2.7,2.7,7.2,0,9.9c-2.7,2.7-7.2,2.7-9.9,0C22.9,36.8,22.9,32.3,25.6,29.6z M36.4,76.1c-1.4,2.3-4.3,3-6.5,1.7 c-2.3-1.4-3-4.3-1.7-6.5c8.1-13.1,23.9-13.1,32,0c1.4,2.3,0.6,5.2-1.7,6.5c-2.3,1.4-5.2,0.6-6.5-1.7 C48.7,69.6,39.6,69.6,36.4,76.1z M74.4,39.5c-2.7,2.7-7.2,2.7-9.9,0c-2.7-2.7-2.7-7.2,0-9.9c2.7-2.7,7.2-2.7,9.9,0 C77.1,32.3,77.1,36.8,74.4,39.5z'/></svg>"), auto;
    }

    .sticky-container {
      position: sticky;
      top: 100px;
      height: 200px;
      z-index: 50;
      overflow: visible;
    }
    
    /* Letter effect styling */
    .letter {
      display: inline-block;
      transition: transform 0.3s ease-out;
    }
    
    @media (max-width: 768px) {
      .item {
        font-size: 32px;
      }
    }
  </style>
</head>
<body>
  <div id="content">
    <div class="items-container">
      <div class="item">ITEM A</div>
      <div class="item">TRACK 01</div>
      <div class="item">ITEM B</div>
      <div class="item">LATEST RELEASE</div>
      <div class="item">ITEM C</div>
      <div class="item">MUSIC PRODUCER</div>
      <div class="item">ITEM D</div>
      <div class="item">CONTACT INFO</div>
      <div class="item">ITEM E</div>
      <div class="item">ALBUM TITLE</div>
      <div class="item">ITEM F</div>
      <div class="item">SOUND DESIGN</div>
      <div class="item">ITEM G</div>
      <div class="item">MIXING & MASTERING</div>
      <div class="item">ITEM H</div>
      <div class="item">COLLABORATIONS</div>
      <div class="item">ITEM I</div>
      <div class="item">UPCOMING SHOWS</div>
      <div class="item">ITEM J</div>
    </div>
  </div>
  
  <script>
    const items = document.querySelectorAll('.item');
    const content = document.getElementById('content');

    // Create sticky container
    const stickyContainer = document.createElement('div');
    stickyContainer.className = 'sticky-container';
    content.prepend(stickyContainer);

    // Item states
    const itemStates = {};

    // Split text into letter spans
    function splitTextIntoLetters(element) {
      const text = element.innerText;
      element.innerHTML = '';
      
      // Create a span for each letter
      for (let i = 0; i < text.length; i++) {
        const letter = document.createElement('span');
        letter.className = 'letter';
        letter.innerText = text[i];
        element.appendChild(letter);
      }
      
      return element.querySelectorAll('.letter');
    }

    // Function to clear all items - for fixing state issues
    function resetAllItems() {
      // Clear all sticky items
      while (stickyContainer.firstChild) {
        stickyContainer.removeChild(stickyContainer.firstChild);
      }
      
      // Reset item states
      Object.keys(itemStates).forEach(key => {
        delete itemStates[key];
      });
      
      // Show all original items
      items.forEach(item => {
        item.style.opacity = 1;
      });
    }

    window.addEventListener('scroll', () => {
      const currentScrollY = window.scrollY;
      
      // Reset everything if we scroll back to top
      if (currentScrollY < 50) {
        resetAllItems();
      }
      
      items.forEach((item, index) => {
        const rect = item.getBoundingClientRect();
        
        // If item reaches threshold
        if (rect.top < 200 && rect.bottom > 0) {  // Only process visible items
          if (!itemStates[index]) {
            // Clone the item for the sticky container
            const clone = item.cloneNode(true);
            clone.id = `sticky-${index}`;
            clone.style.position = 'absolute';
            stickyContainer.appendChild(clone);
            
            // Split text into letters
            const letters = splitTextIntoLetters(clone);
            
            // Mark this item as at the top
            itemStates[index] = {
              element: clone,
              letters: letters,
              x: 0,
              y: 0, 
              rotation: 0,
              chaos: 0
            };
            
            // Hide original
            item.style.opacity = 0;
          }
          
          // Increase chaos based on how far we've scrolled past it
          const distancePastThreshold = 200 - rect.top;
          const chaos = Math.min(1, distancePastThreshold / 300);
          
          itemStates[index].chaos = chaos;
          
          // Apply letter separation effect
          itemStates[index].letters.forEach((letter, i) => {
            const randomX = (Math.random() * 60 - 30) * chaos;
            const randomY = (Math.random() * 40 - 20) * chaos;
            const randomRotate = (Math.random() * 40 - 20) * chaos;
            
            letter.style.transform = `translate(${randomX}px, ${randomY}px) rotate(${randomRotate}deg)`;
          });
          
          // Also apply some movement to the whole item
          itemStates[index].x += (Math.random() * 10 - 5) * chaos;
          itemStates[index].y = Math.random() * 10 * chaos;
          itemStates[index].rotation += (Math.random() * 5 - 2.5) * chaos;
          
          // Apply transformation to whole item
          itemStates[index].element.style.transform = 
            `translate(${itemStates[index].x}px, ${itemStates[index].y}px) rotate(${itemStates[index].rotation}deg)`;
        }
        // If item is not at threshold and has a state (scrolling back up)
        else if (rect.top >= 200 && itemStates[index]) {
          // Remove from sticky container and reset
          if (itemStates[index].element.parentNode === stickyContainer) {
            stickyContainer.removeChild(itemStates[index].element);
          }
          delete itemStates[index];
          item.style.opacity = 1;
        }
      });
    });
    
    // Double-check reset on page load
    resetAllItems();
    
    // Handle manual reset if things get stuck
    document.addEventListener('keydown', function(e) {
      // Press Escape key to reset everything
      if (e.key === 'Escape') {
        resetAllItems();
      }
    });
  </script>
</body>
</html>
